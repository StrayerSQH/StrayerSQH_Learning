# UKF调参
## P:估计误差协方差矩阵
它度量了我们对状态向量估计的不确定度。具体来说，P是一个对称正定矩阵，其对角线元素表示状态向量中各个元素估计的不确定性（方差），非对角线元素表示不同状态元素之间的相关性（协方差）.
### P的作用
不确定性度量：P矩阵提供了关于当前状态估计不确定性的量化信息。一个较大的P值表示我们对状态的估计有较高的不确定性，而一个较小的P值则表示我们对状态的估计较为确定。
权重分配：在UKF的更新步骤中，P与观测噪声协方差R一起决定了状态更新时模型预测和观测数据之间的相对权重。如果P的某个元素较大，表示对应状态的不确定性较高，那么滤波器在更新时会更倾向于相信观测数据；反之，如果P的某个元素较小，滤波器会更倾向于相信模型预测。
协方差传播：在预测步骤中，P通过状态转移函数和过程噪声协方差Q进行传播，以反映由于系统动态和噪声引起的不确定性增长。
### 如何设置和更新P
初始设置：在滤波器的初始化阶段，需要根据先验知识来设置初始的P矩阵。这通常涉及对系统状态的初始不确定性进行合理的估计。
迭代更新：在每个时间步，通过UKF的预测和更新步骤来迭代更新P矩阵。预测步骤根据状态转移函数和过程噪声协方差Q来更新P，而更新步骤则根据观测数据和观测噪声协方差R来调整P。
数值稳定性：在迭代更新过程中，需要确保P矩阵保持正定性，以避免数值稳定性问题。有时可能需要采用一些数值技巧（如平方根滤波形式）来保持P的正定性。
## Q:过程噪声协方差
过程噪声协方差Q描述了由于系统内部动态的不确定性和模型误差导致的状态转移的不确定性。它反映了在没有新的观测数据时，我们对状态变量如何随时间变化的信任程度。
### 如果Q设置得太小：
滤波器会过于信任模型预测，即认为模型能够非常准确地描述系统的真实动态。
这可能导致滤波器对突发的或模型未捕获的变化不够敏感，从而使状态估计偏离真实值。
### 如果Q设置得太大：
滤波器将不太信任模型预测，认为状态转移中存在较大的不确定性。
这可能导致滤波器对观测数据给予更大的权重，但如果观测数据本身也包含噪声，那么状态估计可能会受到观测噪声的较大影响。
## R:观测噪声协方差
观测噪声协方差R描述了观测数据的不确定性，即由于传感器误差或其他测量误差导致的观测值与实际状态值之间的偏差。
### 如果R设置得太小：
滤波器会过于信任观测数据，认为观测值非常接近真实状态。
这可能导致滤波器对模型预测不够重视，如果模型预测是准确的，但观测数据由于某种原因（如传感器故障）出现了偏差，那么状态估计可能会偏离真实值。
### 如果R设置得太大：
滤波器将不太信任观测数据，认为观测值包含较大的噪声或误差。
这会导致滤波器更加依赖模型预测，但如果模型预测不准确，那么状态估计同样可能会偏离真实值。

## 代码实现
```
import math
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from filterpy.kalman import UnscentedKalmanFilter
from filterpy.kalman import MerweScaledSigmaPoints

#define basic information
times = 18000
dt = 0.1

def state_eqn(x, dt):
  return x

def observation_eqn(x):
  return z

dim_x = 7  
dim_z = 7  

points = MerweScaledSigmaPoints(n=dim_x, alpha=1, beta=2.0, kappa=1.0)

ukf = UnscentedKalmanFilter(dim_x=dim_x, dim_z=dim_z, dt=dt, hx=observation_eqn, fx=state_eqn, points=points)

ukf.x = np.array([0.632782,0.421779,-0.646526,0.060773, 0.021263,-0.058420,-0.000005])
ukf.P = np.eye(dim_x) * 1 

ukf.Q = np.eye(7) * 1e-7  
ukf.R = np.eye(7) * 1e-5 

filtered_data = np.zeros((times, 7))

for i in range(times):
    ukf.predict()
    observed_data = ...
    ukf.update(observed_data)

    filtered_data[i] = ukf.x
```
